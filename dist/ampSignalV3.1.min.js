(()=>{(async function(){let a=document.getElementById("zzazz-signal-div"),w=a?.getAttribute("data-zzazz-t-id"),P="https://a.zzazz.com/event",N="https://cdn.zzazz.com/widget-rules",k="https://beta.v.zzazz.com/api/v3/price",o={user_id:null,event_id:null},d=[],u=!1,f=!1,s=null,p=!1,y=null,z=null,v=null,l=!1,h=()=>({width:window?.innerWidth||document?.documentElement?.clientWidth||0,height:window?.innerHeight||document?.documentElement?.clientHeight||0}),g=()=>({width:window?.screen?.width||0,height:window?.screen?.height||0}),I=({user_id:e,event_id:t})=>{e&&!o.user_id&&(o.user_id=e),t&&!o.event_id&&(o.event_id=t,u=!0,b())};function E(e,t){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>{e.apply(this,i)},t)}}let _=E(()=>{U()},500),B=E(e=>{C(e)},500);document?.addEventListener("scroll",_),document?.addEventListener("click",B);async function c(e,t={}){let n={type:e,...t};e==="price"||e==="poll"?n.id=o.event_id:(e==="scroll"||e==="click")&&(n.pageId=o.event_id);let i={Accept:"application/json","Content-Type":"application/json","tracking-id":`${w}`,...o.user_id&&{"user-id":o.user_id}};try{let r=await fetch(P,{method:"POST",credentials:"include",headers:i,body:JSON.stringify(n)}),m=await r.json().catch(()=>null);return{ok:r.ok,data:m}}catch(r){return console.error(`Failed to send event ${e}:`,r),{ok:!1,data:null}}}function L(e,t={}){d.push({type:e,payload:t}),b()}async function b(){if(!(!u||f)){for(f=!0;d.length;){let{type:e,payload:t}=d.shift();await c(e,t)}f=!1}}async function D(e){clearTimeout(y),z=e,l=!1,v=new Date().getTime();let t={is_amp:!0,browser:h(),device:g(),url:e,referrer:document?.referrer||""},{ok:n,data:i}=await c("pageview",t);n&&i&&I(i),T(e)}async function T(e){if(e===z){let t=new Date().getTime()-v>6e5?6e4:5e3;try{await c("poll")}catch(n){console.error(n)}finally{y=setTimeout(()=>T(e),t)}}}async function O(e){if(!l){if(!u)return l=!0,L("price",e);l=!0;try{await c("price",e)}catch(t){console.error(t),l=!1}}}async function U(){try{let e={scrollPosition:window?.scrollY||0,browser:h(),device:g()};await c("scroll",e)}catch(e){console.log(e)}}function j(e){if(!e)return null;if(e.tagName==="A"&&e.href)return e.href;if(e.tagName==="BUTTON"&&e.formAction)return e.formAction;if(e.tagName==="BUTTON"&&e.getAttribute("data-url"))return e.getAttribute("data-url");let t=e.parentNode;for(;t;){let n=t.tagName;if(n==="A"&&t.href)return t.href;if(n==="BUTTON"&&t.formAction)return t.formAction;if(n==="BUTTON"&&t.getAttribute("data-url"))return t.getAttribute("data-url");t=t.parentNode}return null}async function C(e){try{let t=e?.target,n={browser:h(),device:g(),element:{tag:t?.tagName?.toLowerCase()||null,url:j(t)||null,position:{x:e?.pageX||0,y:e?.pageY||0}}};await c("click",n)}catch(t){console.log(t)}}async function S(){try{return(await(await fetch(`${N}/${w}.json?dt=${Date.now()}`)).json()).showWidget===!0}catch(e){return console.error("Enable API error:",e),!1}}async function A(){let e=a?.getAttribute("data-url");if(e)try{let i=(await(await fetch(`${k}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({urls:[e],currency:"inr"})})).json())[e];if(!i||isNaN(i.qap)){a.classList.add("hidden"),p=!1;return}let r=i.qap;O({url:e,qap:i.qap,price:i.price,currency:"inr"});let m=document.getElementById("zzazz-price"),$=document.getElementById("zzazz-trend-up"),q=document.getElementById("zzazz-trend-down");m.firstChild.textContent=`${r.toFixed(2)} `,p||(a.classList.remove("hidden"),p=!0),s!==null&&($.style.display=r>=s?"flex":"none",q.style.display=r<s?"flex":"none"),s=r}catch(t){console.error("Price fetch error:",t),a.classList.add("hidden")}}if(!await S()){console.warn("Price pill disabled remotely."),a?.classList.add("hidden");return}console.log("Price pill enabled by remote rules."),D(window?.location?.origin||document?.location?.origin||""),A(),setInterval(A,3e3)})();})();
